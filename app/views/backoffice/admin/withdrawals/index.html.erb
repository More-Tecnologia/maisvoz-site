<div class="content-page">
  <!-- Start content -->
  <div class="content">
    <div class="container">

      <!-- Page-Title -->
      <div class="row">
        <div class="col-sm-12">
          <h4 class="page-title"><%= t('.title') %></h4>
          <p class="text-muted page-title-alt"><%= t('.subtitle') %></p>
        </div>
      </div>

      <%= render 'filters', q: q %>

      <div class="row">
        <div class="col-sm-12">
          <div class="card-box">
            <div class="row">
              <div class="col-lg-12">

                <table class="table table-bordered table-hover m-0">

                  <thead>
                    <tr>
                      <th>#</th>
                      <th><%= User.human_attribute_name(:username) %></th>
                      <th><%= User.human_attribute_name(:name) %></th>
                      <th><%= sort_link(q, :available_balance_cents, Account.human_attribute_name(:balance)) %></th>
                      <th><%= sort_link(q, :amount_cents, Withdrawal.human_attribute_name(:amount)) %></th>
                      <th><%= sort_link(q, :status, Withdrawal.human_attribute_name(:status)) %></th>
                      <th><%= sort_link(q, :created_at, Withdrawal.human_attribute_name(:created_at), default_order: :desc) %></th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <% withdrawals.each do |withdraw| %>
                      <tr>
                        <th><%= withdraw.id %></th>
                        <th><%= withdraw.user.username %></th>
                        <th><%= withdraw.user.name %></th>
                        <th><%= number_to_currency withdraw.user.available_balance %></th>
                        <td><%= number_to_currency withdraw.amount %></td>
                        <td><%= t withdraw.status %></td>
                        <td><%= l withdraw.created_at, format: :short %></td>
                        <td>
                          <% if withdraw.pending? %>
                            <%= link_to(
                              backoffice_admin_withdrawal_path(withdraw, status: Withdrawal.statuses[:approved]),
                              method: :put,
                              data: { confirm: t('.approve_withdraw') },
                              class: 'm-r-10'
                              ) do %>
                              <i class="icon-like"></i>
                            <% end %>
                            <%= link_to(
                              backoffice_admin_withdrawal_path(withdraw, status: Withdrawal.statuses[:refused]),
                              method: :put,
                              data: { confirm: t('.refuse_withdraw') }
                              ) do %>
                              <i class="icon-dislike"></i>
                            <% end %>
                          <% end %>
                        </td>
                      </tr>
                    <% end %>
                    <% if withdrawals.empty? %>
                      <tr>
                        <td colspan="8" class="text-center"><%= t('.no_data') %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>

                <%= paginate withdrawals %>

              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
