<!-- Page-Title -->
<div class="row">
  <div class="col-sm-12">
    <h4 class="page-title m-b-30">Novo Veículo</h4>
  </div>
</div>

<% if form.monthly_fee.present? %>
<div class="row">
    <div class="col-sm-12">
        <div class="card-box m-b-20 card-body">
            <h5 class="card-title">Tipo de Mensalidade</h5>
            <p class="card-text"><%= form.club_motors_fee.name %> - (<%= form.car_brand.name %>) <%= form.car_model.name %></p>
            <a href="#" class="btn btn-success"><%= number_to_currency form.monthly_fee %>/mês</a>
        </div>
    </div>
</div>
<% end %>

<div class="row">
  <div class="col-lg-12">
    <div class="card-box">
      <%= simple_form_for form, url: backoffice_club_motors_vehicles_path, method: :post do |f| %>
        <div class="row">
        <%= f.input :car_brand_id, collection: CarBrand.order(:name).map {|brand| [brand.name, brand.brand_code]}, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-brand' } %>
        <%= f.input :car_model_id, collection: form.car_models_list.map {|model| [model.name, model.id]}, wrapper_html: { class: 'col-sm-6' } %>
        <%= f.input :chassis, wrapper_html: { class: 'col-sm-3' } %>
        <%= f.input :plate, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-plate' } %>
        <%= f.input :cnpj_cpf, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-cnpj-cpf' } %>
        <%= f.input :owner_name, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-owner-name' } %>
        <%= f.input :manufacture_year, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-manufacture-year' } %>
        <%= f.input :model_year, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-model-year' } %>
        <%= f.input :fuel, wrapper_html: { class: 'col-sm-3' }, collection: ClubMotorsSubscription.fuels.map {|k,v| [t(k), k]} %>
        <%= f.input :mileage, wrapper_html: { class: 'col-sm-3' } %>
        <%= f.input :renavam, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-renavam' } %>
        <%= f.input :gearbox, wrapper_html: { class: 'col-sm-3' }, collection: ClubMotorsSubscription.gearboxes.map {|k,v| [t(k), k]} %>
        <%= f.input :taxi, wrapper_html: { class: 'col-sm-3' }, collection: ['Sim', 'Não'] %>
        <%= f.input :mercosul_code, wrapper_html: { class: 'col-sm-3' }, collection: ClubMotorsSubscription.mercosul_codes.map {|k,v| [t(k), k]} %>
        <%= f.input :color, wrapper_html: { class: 'col-sm-3' }, input_html: { class: 'input-color' } %>
        <%= f.input :color_type, wrapper_html: { class: 'col-sm-3' }, collection: ClubMotorsSubscription.color_types.map {|k,v| [t(k), k]} %>
        <%= f.input :origin, wrapper_html: { class: 'col-sm-3' }, collection: ClubMotorsSubscription.origins.map {|k,v| [t(k), k]} %>
        </div>

        <hr>

        <div class="row">
          <%= f.input :voucher_code, wrapper_html: { class: 'col-sm-3' }, label: false, placeholder: 'Voucher' %>
          <div class="col-sm-3">
            <%= f.submit 'Aplicar', class: 'btn btn-primary' %>

            <% if form.voucher.present? && !form.voucher.used? %>
              <p class="text-success">Voucher aplicado com sucesso!</p>
            <% end %>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="card-box">
              <%= render partial: 'terms' %>
              <%= f.input :terms_of_service, as: :boolean, label: 'Termos de Serviço' %>
            </div>
          </div>
        </div>

        <%= f.submit "Ativar cadastro do veículo ao ClubMotors", class: 'btn btn-primary btn-block' %>
      <% end %>
    </div>
  </div>
</div>

<script>
  window.onload = function(){
    $('#club_motors_subscription_form_car_brand_id, #club_motors_subscription_form_car_model_id').change(function () {
      $(this).parents('form').submit();
    });

    $('#voucher_btn').click(function () {
      $(this).parents('form').submit();
    });

    $('.input-plate').mask('AAAAAAA', {clearIfNotMatch: true});
  }
</script>
